+function(c){var e=c("#upload_excel");var d=c("#filename");var b=c("#upload_form");var a=c("#select_statement");var k=c("#selectQN");var j=c("#statement_date");var h=c("#view_code");e.on("change",f);function f(){var l=e.val();d.html(l.substring(l.lastIndexOf("\\")+1));c.ajax({url:"/statements_parse_action",type:"post",dataType:"json",data:new FormData(b[0]),async:false,cache:false,contentType:false,processData:false,success:function(m){if(m.length==0){alert("报表格式错误或无内容");a.html("");k.html("");j.html("");h.html("")}else{i(m)}},error:function(n,m,o){console.error(o)}});return false}function g(o,m,l){var n=c("<option>");n.prop({value:m});n.html(o);l.append(n)}function i(n){var l={};a.html("");for(var m in n){if(n.hasOwnProperty(m)&&m!="length"){g(m,m,a);l[m]=o(n[m])}}a.on("change",function(){k.html("");if(a.val().indexOf("资产负债表")!=-1){g("期末余额","qms",k);g("年初余额","ncs",k)}else{g("本月金额","qms",k);g("本年累计","ncs",k)}k.trigger("change")});k.on("change",function(){var p=l[a.val()].date;j.html("");g(p.getFullYear()+"年"+(p.getMonth()+1)+"月"+p.getDate()+"日","statement_date",j);h.html(l[a.val()][k.val()])});a.trigger("change");function o(w){var t=w.data;var s={};var z,x,v,A;var u={};s.qms={};s.ncs={};if(w.name.indexOf("资产负债表")!=-1){s.date=y(t[2][8]);z=[2,6];x=[3,7];v=[4,8];A=[5,36];u={qms:"qms",ncs:"ncs"}}else{if(w.name.indexOf("利润表")!=-1){s.date=y(t[2][5]);z=[2];x=[5];v=[3];A=[4,36];u={qms:"sns",ncs:"bns"}}}q(z,x,v,A);for(var p in s){if(p!="date"){s[p]=r(s[p],u[p])}}return s;function r(D,C){var B="";B='+function () {var inputs = document.getElementsByTagName("input");var '+C+' = {};for (var i = 0; i < inputs.length; i++) {var name = inputs[i].name;if (name.substr(0, 3) == "'+C+'") {if(inputs[i].disabled==false){'+C+"[name.substr(4, 5)] = inputs[i];}}}var obj="+JSON.stringify(D)+";for(var q in "+C+") {"+C+"[q].value = obj[q];"+C+"[q].onblur();}}()";return B}function q(I,B,E,F){for(var C=0;C<I.length;C++){for(var H=F[0];H<F[1];H++){var G=D(t[H][I[C]]);if(G){s.qms[G]=Math.round(t[H][B[C]]*100)/100||0;s.ncs[G]=Math.round(t[H][E[C]]*100)/100||0}}}function D(J){if(J==null){return}if(J<10){return"0"+J}else{return""+J}}}function y(B){return new Date(new Date(1900,0,0).getTime()-1+B*24*60*60*1000)}}}}(jQuery);